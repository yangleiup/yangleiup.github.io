<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 源码学习（六）：组件渲染 | 地狱猫</title>
    <meta name="description" content="向前一小步文明一大步">
    
    
    <link rel="preload" href="/assets/css/0.styles.5b15de55.css" as="style"><link rel="preload" href="/assets/js/app.fb616f75.js" as="script"><link rel="preload" href="/assets/js/2.c2339c3e.js" as="script"><link rel="preload" href="/assets/js/104.7a13e78e.js" as="script"><link rel="prefetch" href="/assets/js/10.1b314e71.js"><link rel="prefetch" href="/assets/js/100.f97109d5.js"><link rel="prefetch" href="/assets/js/101.f3c4a370.js"><link rel="prefetch" href="/assets/js/102.59e667d9.js"><link rel="prefetch" href="/assets/js/103.1e129d72.js"><link rel="prefetch" href="/assets/js/105.4a071eba.js"><link rel="prefetch" href="/assets/js/106.22ec4c6f.js"><link rel="prefetch" href="/assets/js/107.afe7c943.js"><link rel="prefetch" href="/assets/js/108.8e93cbe3.js"><link rel="prefetch" href="/assets/js/109.d212e52b.js"><link rel="prefetch" href="/assets/js/11.ed035e9e.js"><link rel="prefetch" href="/assets/js/110.936e9647.js"><link rel="prefetch" href="/assets/js/111.6c3a08fe.js"><link rel="prefetch" href="/assets/js/112.ea9dc306.js"><link rel="prefetch" href="/assets/js/113.42ac0741.js"><link rel="prefetch" href="/assets/js/114.8dfce964.js"><link rel="prefetch" href="/assets/js/115.f85e9b76.js"><link rel="prefetch" href="/assets/js/116.613366bc.js"><link rel="prefetch" href="/assets/js/117.a6b9c9a1.js"><link rel="prefetch" href="/assets/js/118.d097d988.js"><link rel="prefetch" href="/assets/js/119.3893c2f3.js"><link rel="prefetch" href="/assets/js/12.406b1a55.js"><link rel="prefetch" href="/assets/js/120.9a30e5ad.js"><link rel="prefetch" href="/assets/js/121.8785d250.js"><link rel="prefetch" href="/assets/js/122.44a0cfb2.js"><link rel="prefetch" href="/assets/js/123.6acf6307.js"><link rel="prefetch" href="/assets/js/124.41801d93.js"><link rel="prefetch" href="/assets/js/125.937d1678.js"><link rel="prefetch" href="/assets/js/126.32316ee6.js"><link rel="prefetch" href="/assets/js/127.d851a6bf.js"><link rel="prefetch" href="/assets/js/128.cc32c108.js"><link rel="prefetch" href="/assets/js/129.9b724cee.js"><link rel="prefetch" href="/assets/js/13.4ff37fc0.js"><link rel="prefetch" href="/assets/js/130.a2809baf.js"><link rel="prefetch" href="/assets/js/14.dabd6f1c.js"><link rel="prefetch" href="/assets/js/15.bc2b5095.js"><link rel="prefetch" href="/assets/js/16.1792f1a1.js"><link rel="prefetch" href="/assets/js/17.3e595d76.js"><link rel="prefetch" href="/assets/js/18.024ec26d.js"><link rel="prefetch" href="/assets/js/19.e974412a.js"><link rel="prefetch" href="/assets/js/20.feaff427.js"><link rel="prefetch" href="/assets/js/21.7415ed36.js"><link rel="prefetch" href="/assets/js/22.017b8ee6.js"><link rel="prefetch" href="/assets/js/23.e3d63843.js"><link rel="prefetch" href="/assets/js/24.c31d9103.js"><link rel="prefetch" href="/assets/js/25.b47e584b.js"><link rel="prefetch" href="/assets/js/26.7dd76a0f.js"><link rel="prefetch" href="/assets/js/27.2a3fff7c.js"><link rel="prefetch" href="/assets/js/28.83ba67aa.js"><link rel="prefetch" href="/assets/js/29.dce87ad0.js"><link rel="prefetch" href="/assets/js/3.55fc7466.js"><link rel="prefetch" href="/assets/js/30.62d74db8.js"><link rel="prefetch" href="/assets/js/31.ef410e43.js"><link rel="prefetch" href="/assets/js/32.0876c249.js"><link rel="prefetch" href="/assets/js/33.343fa3ee.js"><link rel="prefetch" href="/assets/js/34.68ce23d3.js"><link rel="prefetch" href="/assets/js/35.0be319f3.js"><link rel="prefetch" href="/assets/js/36.9fb7145f.js"><link rel="prefetch" href="/assets/js/37.879f8d18.js"><link rel="prefetch" href="/assets/js/38.df50b170.js"><link rel="prefetch" href="/assets/js/39.64f9f1aa.js"><link rel="prefetch" href="/assets/js/4.a18312b1.js"><link rel="prefetch" href="/assets/js/40.b2445a2b.js"><link rel="prefetch" href="/assets/js/41.b90761d7.js"><link rel="prefetch" href="/assets/js/42.34f37c35.js"><link rel="prefetch" href="/assets/js/43.c713fd6d.js"><link rel="prefetch" href="/assets/js/44.1b7f2705.js"><link rel="prefetch" href="/assets/js/45.678cedc6.js"><link rel="prefetch" href="/assets/js/46.c96a8613.js"><link rel="prefetch" href="/assets/js/47.98404030.js"><link rel="prefetch" href="/assets/js/48.23aabf46.js"><link rel="prefetch" href="/assets/js/49.598863fb.js"><link rel="prefetch" href="/assets/js/5.98f0c28f.js"><link rel="prefetch" href="/assets/js/50.55467f59.js"><link rel="prefetch" href="/assets/js/51.26212370.js"><link rel="prefetch" href="/assets/js/52.d60f76c3.js"><link rel="prefetch" href="/assets/js/53.332e4449.js"><link rel="prefetch" href="/assets/js/54.dd5137ac.js"><link rel="prefetch" href="/assets/js/55.c2d1811d.js"><link rel="prefetch" href="/assets/js/56.a6d278ca.js"><link rel="prefetch" href="/assets/js/57.f1846ef6.js"><link rel="prefetch" href="/assets/js/58.86c19289.js"><link rel="prefetch" href="/assets/js/59.d7332f15.js"><link rel="prefetch" href="/assets/js/6.58534a9b.js"><link rel="prefetch" href="/assets/js/60.8ddb5f8c.js"><link rel="prefetch" href="/assets/js/61.9798d77a.js"><link rel="prefetch" href="/assets/js/62.756642f0.js"><link rel="prefetch" href="/assets/js/63.56762851.js"><link rel="prefetch" href="/assets/js/64.c4630a5c.js"><link rel="prefetch" href="/assets/js/65.ffe81bab.js"><link rel="prefetch" href="/assets/js/66.ca97f871.js"><link rel="prefetch" href="/assets/js/67.bd8a46f2.js"><link rel="prefetch" href="/assets/js/68.fd44172f.js"><link rel="prefetch" href="/assets/js/69.6099b948.js"><link rel="prefetch" href="/assets/js/7.940bee0b.js"><link rel="prefetch" href="/assets/js/70.be4a6489.js"><link rel="prefetch" href="/assets/js/71.4f5e4273.js"><link rel="prefetch" href="/assets/js/72.9a30afb8.js"><link rel="prefetch" href="/assets/js/73.948a8173.js"><link rel="prefetch" href="/assets/js/74.ef22395d.js"><link rel="prefetch" href="/assets/js/75.eb978e98.js"><link rel="prefetch" href="/assets/js/76.48ad1450.js"><link rel="prefetch" href="/assets/js/77.a5b9c9e0.js"><link rel="prefetch" href="/assets/js/78.caff3dc7.js"><link rel="prefetch" href="/assets/js/79.4eed3c6b.js"><link rel="prefetch" href="/assets/js/8.0dd0b210.js"><link rel="prefetch" href="/assets/js/80.5fed2f73.js"><link rel="prefetch" href="/assets/js/81.b9260315.js"><link rel="prefetch" href="/assets/js/82.9f550de8.js"><link rel="prefetch" href="/assets/js/83.16d8c797.js"><link rel="prefetch" href="/assets/js/84.b5b6e7a3.js"><link rel="prefetch" href="/assets/js/85.8d48bf5c.js"><link rel="prefetch" href="/assets/js/86.6b68caca.js"><link rel="prefetch" href="/assets/js/87.09bfaf4d.js"><link rel="prefetch" href="/assets/js/88.ce0a5715.js"><link rel="prefetch" href="/assets/js/89.0ae25153.js"><link rel="prefetch" href="/assets/js/9.78eb1038.js"><link rel="prefetch" href="/assets/js/90.7da397a9.js"><link rel="prefetch" href="/assets/js/91.6020f950.js"><link rel="prefetch" href="/assets/js/92.ac72f450.js"><link rel="prefetch" href="/assets/js/93.b70b8087.js"><link rel="prefetch" href="/assets/js/94.69f92a38.js"><link rel="prefetch" href="/assets/js/95.e44fd8fd.js"><link rel="prefetch" href="/assets/js/96.573e8a83.js"><link rel="prefetch" href="/assets/js/97.aa4f5ef1.js"><link rel="prefetch" href="/assets/js/98.09050547.js"><link rel="prefetch" href="/assets/js/99.905f4403.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b15de55.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">地狱猫</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webpack/基础篇.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">react</a></div><div class="nav-item"><a href="/css/规范.html" class="nav-link">css</a></div><div class="nav-item"><a href="/day/a标签href不能下载图片.html" class="nav-link">日常</a></div><div class="nav-item"><a href="/tool/emoij美化你的commitlog.html" class="nav-link">工具</a></div><div class="nav-item"><a href="/accumulate/jserror.html" class="nav-link">积累</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/datastruct/" class="nav-link">数据结构</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webpack/基础篇.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">react</a></div><div class="nav-item"><a href="/css/规范.html" class="nav-link">css</a></div><div class="nav-item"><a href="/day/a标签href不能下载图片.html" class="nav-link">日常</a></div><div class="nav-item"><a href="/tool/emoij美化你的commitlog.html" class="nav-link">工具</a></div><div class="nav-item"><a href="/accumulate/jserror.html" class="nav-link">积累</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/datastruct/" class="nav-link">数据结构</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react/React-01.html" class="sidebar-link">React 源码学习（一）：HTML 元素渲染</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>阅读源码成了今年的学习目标之一，在选择 Vue 和 React 之间，我想先阅读 React 。
在考虑到读哪个版本的时候，我想先接触到源码早期的思想可能会更轻松一些，最终我选择阅读 <code>0.3-stable</code> 。
那么接下来，我将从几个方面来解读这个版本的源码。</p></blockquote> <ol><li><a href="https://zongzi531.com/2019/04/01/LSC-React-01/" target="_blank" rel="noopener noreferrer">React 源码学习（一）：HTML 元素渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/02/LSC-React-02/" target="_blank" rel="noopener noreferrer">React 源码学习（二）：HTML 子元素渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/03/LSC-React-03/" target="_blank" rel="noopener noreferrer">React 源码学习（三）：CSS 样式及 DOM 属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/04/LSC-React-04/" target="_blank" rel="noopener noreferrer">React 源码学习（四）：事务机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/05/LSC-React-05/" target="_blank" rel="noopener noreferrer">React 源码学习（五）：事件机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/06/LSC-React-06/" target="_blank" rel="noopener noreferrer">React 源码学习（六）：组件渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/07/LSC-React-07/" target="_blank" rel="noopener noreferrer">React 源码学习（七）：生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/04/08/LSC-React-08/" target="_blank" rel="noopener noreferrer">React 源码学习（八）：组件更新<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/12/18/LSC-React-09/" target="_blank" rel="noopener noreferrer">React 源码学习（九）：“脱胎换骨”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/12/19/LSC-React-10/" target="_blank" rel="noopener noreferrer">React 源码学习（十）：Fiber<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/12/20/LSC-React-11/" target="_blank" rel="noopener noreferrer">React 源码学习（十一）：Scheduling<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zongzi531.com/2019/12/21/LSC-React-12/" target="_blank" rel="noopener noreferrer">React 源码学习（十二）：Reconciliation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <h2 id="react-组件渲染-react-createclass"><a href="#react-组件渲染-react-createclass" aria-hidden="true" class="header-anchor">#</a> React 组件渲染 React.createClass</h2> <p>终于要说到组件渲染了，其实组件渲染就是基于 HTML 元素渲染，我们在重新回到熟悉的例子，这是一个完整的例子：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// #examples</span>
<span class="token keyword">var</span> ExampleApplication <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> elapsed <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>elapsed  <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> seconds <span class="token operator">=</span> elapsed <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span>elapsed <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token punctuation">:</span> <span class="token string">'.0'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> message <span class="token operator">=</span>
      <span class="token string">'React has been successfully running for '</span> <span class="token operator">+</span> seconds <span class="token operator">+</span> <span class="token string">' seconds.'</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token constant">DOM</span><span class="token punctuation">.</span><span class="token function">p</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

React<span class="token punctuation">.</span><span class="token function">renderComponent</span><span class="token punctuation">(</span>
  <span class="token function">ExampleApplication</span><span class="token punctuation">(</span><span class="token punctuation">{</span>elapsed<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>使用 <code>type=&quot;text/jsx&quot;</code> 的形式编写：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">/** @jsx React.DOM */</span>
<span class="token comment">// #examples</span>
<span class="token keyword">var</span> ExampleApplication <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> elapsed <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>elapsed  <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> seconds <span class="token operator">=</span> elapsed <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span>elapsed <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token punctuation">:</span> <span class="token string">'.0'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> message <span class="token operator">=</span>
      <span class="token string">'React has been successfully running for '</span> <span class="token operator">+</span> seconds <span class="token operator">+</span> <span class="token string">' seconds.'</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

React<span class="token punctuation">.</span><span class="token function">renderComponent</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ExampleApplication</span></span> <span class="token attr-name">elapsed</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="复合组件"><a href="#复合组件" aria-hidden="true" class="header-anchor">#</a> 复合组件</h3> <p>在这里，我们看到创建组件的方法是 <code>React.createClass</code> ，组件就是一堆 HTML 元素的集合，但是组件具有状态 (<code>state</code>) 和属性 (<code>props</code>) ，还具有生命周期，并且组件可以更新。所以我们会一一将其到来，那么本次我们仅讨论组件渲染。我们看到复合组件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactCompositeComponent.js</span>
<span class="token keyword">var</span> ReactCompositeComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">createClass</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">spec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token function-variable function">Constructor</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initialProps<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>initialProps<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactCompositeComponentBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Constructor<span class="token punctuation">;</span>
    <span class="token function">mixSpecIntoComponent</span><span class="token punctuation">(</span>Constructor<span class="token punctuation">,</span> spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>
      <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>render<span class="token punctuation">,</span>
      <span class="token string">'createClass(...): Class specification must implement a `render` method.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">ConvenienceConstructor</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    ConvenienceConstructor<span class="token punctuation">.</span>componentConstructor <span class="token operator">=</span> Constructor<span class="token punctuation">;</span>
    ConvenienceConstructor<span class="token punctuation">.</span>originalSpec <span class="token operator">=</span> spec<span class="token punctuation">;</span>
    <span class="token keyword">return</span> ConvenienceConstructor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>看到 <code>React.createClass</code> 是不是发现和 <code>ReactDOM.js</code> 下的 <code>createDOMComponentClass</code> 函数很相似。确实如此，在你看懂了 HTML 元素渲染的实现后来看这个确实会容易很多，那么接受参数 <code>spec</code> 是什么呢？是 <code>specification</code> 规范，按照官方注释翻译为：在给定类规范的情况下创建复合组件类。我们从上面代码也可以看出 <code>render</code> 方法是必不可少的。他的原型映射到 <code>ReactCompositeComponentBase</code> ，那么让我们来看看他。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactCompositeComponent.js</span>
<span class="token keyword">var</span> <span class="token function-variable function">ReactCompositeComponentBase</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactComponent<span class="token punctuation">.</span>Mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactOwner<span class="token punctuation">.</span>Mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactPropTransferer<span class="token punctuation">.</span>Mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactCompositeComponentMixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="渲染至-dom-节点方法-mountcomponent"><a href="#渲染至-dom-节点方法-mountcomponent" aria-hidden="true" class="header-anchor">#</a> 渲染至 DOM 节点方法 mountComponent</h3> <p>熟悉吧， React 这种写法，原型链上的属性疯狂合并，并且原型链上的属性互相被连续调用。当然在方法中也有这样一行代码 <code>mixSpecIntoComponent(Constructor, spec);</code> ，他在 <code>mixInto</code> 的基础上做了更多的处理，但是他与 <code>mixInto</code> 的功能效果是一样的。那么接下来，先让我们看到当执行 <code>React.renderComponent</code> 方法后，复合组件会做出什么样的反应。我们看到代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactCompositeComponent.js</span>
<span class="token keyword">var</span> ReactCompositeComponentMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">construct</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">initialProps<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ReactComponent<span class="token punctuation">.</span>Mixin<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> initialProps<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_pendingState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_compositeLifeCycleState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">mountComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">rootID<span class="token punctuation">,</span> transaction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里与 ReactNativeComponent.Mixin.mountComponent 一致</span>
    <span class="token comment">// 都执行了此方法，剩下的区别只是针对 HTML 组件和复合组件的区别</span>
    <span class="token comment">// HTML 组件只需产出 markup 标记，添加 CSS 样式， DOM 属性，事件监听</span>
    <span class="token comment">// 复合组件却不一样，上面已经提到过。</span>
    ReactComponent<span class="token punctuation">.</span>Mixin<span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> rootID<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 组件的生命周期和复合组件的生命周期</span>
    <span class="token comment">// Unset `this._lifeCycleState` until after this method is finished.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_lifeCycleState <span class="token operator">=</span> ReactComponent<span class="token punctuation">.</span>LifeCycle<span class="token punctuation">.</span><span class="token constant">UNMOUNTED</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_compositeLifeCycleState <span class="token operator">=</span> CompositeLifeCycle<span class="token punctuation">.</span><span class="token constant">MOUNTING</span><span class="token punctuation">;</span>

    <span class="token comment">// 参数校验</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>propDeclarations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_assertValidProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 绑定 this 执行上下文有关，与 mixSpecIntoComponent 有关联</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_bindAutoBindMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 组件状态相关</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getInitialState <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_pendingState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// 生命周期相关</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>componentWillMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// When mounting, calls to `setState` by `componentWillMount` will set</span>
      <span class="token comment">// `this._pendingState` without triggering a re-render.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_pendingState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pendingState<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_pendingState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 生命周期相关</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>componentDidMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 这里需要特别提一下，你可以看到，这是 React 调度事务，并且 ReactOnDOMReady 在调度事务 close 时</span>
      <span class="token comment">// 会执行队列中的事务，所以你可以理解组件被挂载后这个生命周期是如何实现的。</span>
      transaction<span class="token punctuation">.</span><span class="token function">getReactOnDOMReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>componentDidMount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 调用 _renderValidatedComponent 方法</span>
    <span class="token comment">// 返回 ReactNativeComponent</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_renderedComponent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_renderValidatedComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 生命周期相关</span>
    <span class="token comment">// Done with mounting, `setState` will now trigger UI changes.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_compositeLifeCycleState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_lifeCycleState <span class="token operator">=</span> ReactComponent<span class="token punctuation">.</span>LifeCycle<span class="token punctuation">.</span><span class="token constant">MOUNTED</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用 ReactNativeComponent.mountComponent 生成 markup 标记</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_renderedComponent<span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">(</span>rootID<span class="token punctuation">,</span> transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">_renderValidatedComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这一步使用来控制正确的 Owner</span>
    ReactCurrentOwner<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用 render 方法的返回</span>
    <span class="token keyword">var</span> renderedComponent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这一步使用来控制正确的 Owner</span>
    <span class="token comment">// 在 ReactNativeComponent 实例化时 ReactCurrentOwner.current 会被记录</span>
    ReactCurrentOwner<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>
      ReactComponent<span class="token punctuation">.</span><span class="token function">isValidComponent</span><span class="token punctuation">(</span>renderedComponent<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'%s.render(): A valid ReactComponent must be returned.'</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>displayName <span class="token operator">||</span> <span class="token string">'ReactCompositeComponent'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> renderedComponent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>那么组件渲染讲的也差不多了，我们对其他一些，也先在这边提起来。回到这段代码：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactCompositeComponent.js</span>
<span class="token keyword">var</span> <span class="token function-variable function">ReactCompositeComponentBase</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 一些 DOM 操作， React 调度事务相关，并包括生命周期</span>
<span class="token comment">// ReactNativeComponent 也同样含有</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactComponent<span class="token punctuation">.</span>Mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 用于操作 ref ，相关代码随行在 ReactComponent 中，这里也不做详细解读</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactOwner<span class="token punctuation">.</span>Mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// props 传输功能</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactPropTransferer<span class="token punctuation">.</span>Mixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mixInto</span><span class="token punctuation">(</span>ReactCompositeComponentBase<span class="token punctuation">,</span> ReactCompositeComponentMixin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="react-autobind-处理"><a href="#react-autobind-处理" aria-hidden="true" class="header-anchor">#</a> React.autoBind 处理</h3> <p>简单介绍了这些后我们来看看， <code>mixSpecIntoComponent</code> 方法，既然看到这个方法，我们也要同样提到 <code>React.autoBind</code> 方法。本次我们仅讨论绑定上下文，不讨论其他相关：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactCompositeComponent.js</span>
<span class="token keyword">var</span> ReactCompositeComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 autoBind 的时候返回 unbound 函数</span>
  <span class="token comment">// 将需要被绑定上下文的方法赋值至 __reactAutoBind</span>
  <span class="token function-variable function">autoBind</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">unbound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">invariant</span><span class="token punctuation">(</span>
        <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string">'React.autoBind(...): Attempted to invoke an auto-bound method that '</span> <span class="token operator">+</span>
        <span class="token string">'was not correctly defined on the class specification.'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    unbound<span class="token punctuation">.</span>__reactAutoBind <span class="token operator">=</span> method<span class="token punctuation">;</span>
    <span class="token keyword">return</span> unbound<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">mixSpecIntoComponent</span><span class="token punctuation">(</span><span class="token parameter">Constructor<span class="token punctuation">,</span> spec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> proto <span class="token operator">=</span> <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> name <span class="token keyword">in</span> spec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>spec<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> property <span class="token operator">=</span> spec<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 目前仅保留了与 autoBind 相关代码</span>
    <span class="token comment">// 合并 specification 时，检查是否存在 __reactAutoBind 属性</span>
    <span class="token comment">// 并加入 __reactAutoBindMap</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>__reactAutoBind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>proto<span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        proto<span class="token punctuation">.</span>__reactAutoBindMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      proto<span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> property<span class="token punctuation">.</span>__reactAutoBind<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 其他属性正常合并</span>
      proto<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> property<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token keyword">var</span> ReactCompositeComponentMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">mountComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">rootID<span class="token punctuation">,</span> transaction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token comment">// 挂载组件时检查 __reactAutoBindMap 存在则执行 _bindAutoBindMethods 方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_bindAutoBindMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">_bindAutoBindMethods</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历 __reactAutoBindMap</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> autoBindKey <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>autoBindKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 获取对应的方法</span>
      <span class="token keyword">var</span> method <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__reactAutoBindMap<span class="token punctuation">[</span>autoBindKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 重新返回被绑定过后的方法</span>
      <span class="token keyword">this</span><span class="token punctuation">[</span>autoBindKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_bindAutoBindMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">_bindAutoBindMethod</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取到当前的组件上下文作用域</span>
    <span class="token keyword">var</span> component <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> hasWarned <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">autoBound</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> tooMany</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">invariant</span><span class="token punctuation">(</span>
        <span class="token keyword">typeof</span> tooMany <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">,</span>
        <span class="token string">'React.autoBind(...): Methods can only take a maximum of 5 arguments.'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 判断组件声明周期为已挂载进行绑定</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>component<span class="token punctuation">.</span>_lifeCycleState <span class="token operator">===</span> ReactComponent<span class="token punctuation">.</span>LifeCycle<span class="token punctuation">.</span><span class="token constant">MOUNTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">method</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasWarned<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hasWarned <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token string">'React.autoBind(...): Attempted to invoke an auto-bound method '</span> <span class="token operator">+</span>
            <span class="token string">'on an unmounted instance of `%s`. You either have a memory leak '</span> <span class="token operator">+</span>
            <span class="token string">'or an event handler that is being run after unmounting.'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>displayName <span class="token operator">||</span> <span class="token string">'ReactCompositeComponent'</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> autoBound<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h2 id="卸载组件"><a href="#卸载组件" aria-hidden="true" class="header-anchor">#</a> 卸载组件</h2> <p>那么到这里关于绑定组件上下文的内容也解读完了，既然有组件渲染（挂载），那么就有组件（移除）卸载，这里我们主要看到 <code>React.unmountAndReleaseReactRootNode</code> 方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactMount.js</span>
<span class="token keyword">var</span> ReactMount <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">unmountAndReleaseReactRootNode</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 意思很简单，获取 container 对应的 reactRootID</span>
    <span class="token comment">// 从映射中找到对应的 component</span>
    <span class="token keyword">var</span> reactRootID <span class="token operator">=</span> <span class="token function">getReactRootID</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> component <span class="token operator">=</span> instanceByReactRootID<span class="token punctuation">[</span>reactRootID<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// TODO: Consider throwing if no `component` was found.</span>
    <span class="token comment">// 执行卸载方法</span>
    component<span class="token punctuation">.</span><span class="token function">unmountComponentFromNode</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 清除对应映射缓存</span>
    <span class="token keyword">delete</span> instanceByReactRootID<span class="token punctuation">[</span>reactRootID<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> containersByReactRootID<span class="token punctuation">[</span>reactRootID<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>unmountComponentFromNode</code> 方法我们看到 <code>ReactComponent.js</code> ：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactComponent.js</span>
<span class="token keyword">var</span> ReactComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  Mixin<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">unmountComponentFromNode</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调用对应的 ReactNativeComponent 或 ReactCompositeComponent 组件的 unmountComponent 方法</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unmountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// http://jsperf.com/emptying-a-node</span>
      <span class="token comment">// 遍历移除节点</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        container<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>lastChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">unmountComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 释放内存相关，会被 ReactNativeComponent 或 ReactCompositeComponent 调起</span>
      <span class="token function">invariant</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_lifeCycleState <span class="token operator">===</span> ComponentLifeCycle<span class="token punctuation">.</span><span class="token constant">MOUNTED</span><span class="token punctuation">,</span>
        <span class="token string">'unmountComponent(): Can only unmount a mounted component.'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>ref <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ReactOwner<span class="token punctuation">.</span><span class="token function">removeComponentAsRefFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>ref<span class="token punctuation">,</span> props<span class="token punctuation">[</span><span class="token constant">OWNER</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_rootNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_rootNodeID <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_lifeCycleState <span class="token operator">=</span> ComponentLifeCycle<span class="token punctuation">.</span><span class="token constant">UNMOUNTED</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>我们来分别看下 <code>ReactNativeComponent</code> 或 <code>ReactCompositeComponent</code> 组件的 <code>unmountComponent</code> 方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactNativeComponent.js</span>
ReactNativeComponent<span class="token punctuation">.</span>Mixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">unmountComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 释放内存</span>
    ReactComponent<span class="token punctuation">.</span>Mixin<span class="token punctuation">.</span><span class="token function">unmountComponent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 移除子节点，方法来自于 ReactMultiChild.unmountMultiChild</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unmountMultiChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 移除事件监听</span>
    ReactEvent<span class="token punctuation">.</span><span class="token function">deleteAllListeners</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_rootNodeID<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="遍历卸载子组件"><a href="#遍历卸载子组件" aria-hidden="true" class="header-anchor">#</a> 遍历卸载子组件</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactMultiChild.js</span>
<span class="token keyword">var</span> ReactMultiChildMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">unmountMultiChild</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> renderedChildren <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_renderedChildren<span class="token punctuation">;</span>
    <span class="token comment">// 遍历卸载</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> name <span class="token keyword">in</span> renderedChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>renderedChildren<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> renderedChildren<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> renderedChild <span class="token operator">=</span> renderedChildren<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
        renderedChild<span class="token punctuation">.</span>unmountComponent <span class="token operator">&amp;&amp;</span> renderedChild<span class="token punctuation">.</span><span class="token function">unmountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 释放内存</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_renderedChildren <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactCompositeComponent.js</span>
<span class="token keyword">var</span> ReactCompositeComponentMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">unmountComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_compositeLifeCycleState <span class="token operator">=</span> CompositeLifeCycle<span class="token punctuation">.</span><span class="token constant">UNMOUNTING</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行生命周期</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>componentWillUnmount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_compositeLifeCycleState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    ReactComponent<span class="token punctuation">.</span>Mixin<span class="token punctuation">.</span><span class="token function">unmountComponent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行 ReactNativeComponent.unmountComponent</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_renderedComponent<span class="token punctuation">.</span><span class="token function">unmountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 释放内存</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_renderedComponent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>refs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Some existing components rely on this.props even after they've been</span>
    <span class="token comment">// destroyed (in event handlers).</span>
    <span class="token comment">// TODO: this.props = null;</span>
    <span class="token comment">// TODO: this.state = null;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>那么到此，实现组件渲染功能。</p> <hr> <h2 id="验证组件方法"><a href="#验证组件方法" aria-hidden="true" class="header-anchor">#</a> 验证组件方法</h2> <p>这里还有一点需要提的到是 <code>React.isValidComponent</code> 方法，用来校验是否为 React 组件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/ReactComponent.js</span>
<span class="token keyword">var</span> ReactComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">isValidComponent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 鸭子类型校验法</span>
    <span class="token comment">// object 存在切具有 mountComponentIntoNode 方法 和 receiveProps 方法</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>
      object <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">typeof</span> object<span class="token punctuation">.</span>mountComponentIntoNode <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">typeof</span> object<span class="token punctuation">.</span>receiveProps <span class="token operator">===</span> <span class="token string">'function'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fb616f75.js" defer></script><script src="/assets/js/2.c2339c3e.js" defer></script><script src="/assets/js/104.7a13e78e.js" defer></script>
  </body>
</html>
